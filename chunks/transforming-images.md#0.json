{
  "id": "transforming-images.md#0",
  "post_urls": [
    "https://tds.s-anand.net/#/transforming-images.md",
    "https://tds.s-anand.net/#/../transforming-images.md"
  ],
  "content": "## Transforming Images\n\n### Image Processing with PIL (Pillow)\n\n[! [Python Tutorial: Image Manipulation with Pillow (16 min)](https://i.ytimg.com/vi_webp/6Qs3wObeWwc/sddefault.webp)](https://youtu.be/6Qs3wObeWwc)\n\n[Pillow](https://python-pillow.org/) is Python's leading library for image processing, offering powerful tools for editing, analyzing, and generating images. It handles various formats (PNG, JPEG, GIF, etc.) and provides operations from basic resizing to complex filters. Here's a minimal example showing common operations:\n\n```python\n# /// script\n# requires-python = \">=3.11\"\n# dependencies = [\"Pillow\"]\n# ///\n\nfrom PIL import Image, ImageEnhance, ImageFilter\n\nasync def process_image(path: str) -> Image.Image:\n    \"\"\"Process an image with basic enhancements.\"\"\" with Image.open(path) as img:\n        # Convert to RGB to ensure compatibility\n        img = img.convert('RGB')\n\n        # Resize maintaining aspect ratio\n        img.thumbnail((800, 800))\n\n        # Apply enhancements\n        img = (ImageEnhance.Contrast(img)\n               .enhance(1.2))\n\n        return img.filter(ImageFilter.SHARPEN)\n\nif __name__ == \"__main__\":\n    import asyncio\n    img = asyncio.run(process_image(\"input.jpg\"))\n    img.save(\"output.jpg\", quality=85)\n```\n\nKey features and techniques you'll learn:\n\n- **Image Loading and Saving**: Handle various formats with automatic conversion\n- **Basic Operations**: Resize, rotate, crop, and flip images\n- **Color Manipulation**: Adjust brightness, contrast, and color balance\n- **Filters and Effects**: Apply blur, sharpen, and other visual effects\n- **Drawing**: Add text, shapes, and overlays to images\n- **Batch Processing**: Handle multiple images efficiently\n- **Memory Management**: Process large images without memory issues\n\n### Basic Image Operations\n\nCommon operations for resizing, cropping, and rotating images:\n\n```python\nfrom PIL import Image\n\nasync def transform_image(\n    path: str,\n    size: tuple[int, int],\n    rotation: float = 0\n) -> Image.Image:\n    \"\"\"Transform image with basic operations.\"\"\" with Image.open(path) as img:\n        # Resize with anti-aliasing\n        img = img.resize(size, Image.LANCZOS)\n\n        # Rotate around center\n        if rotation:\n            img = img.rotate(rotation, expand=True)\n\n        # Auto-crop empty edges\n        img = img.crop(img.getbbox())\n\n        return img\n```\n\n### Color and Enhancement\n\nAdjust image appearance with built-in enhancement tools:\n\n```python\nfrom PIL import ImageEnhance, ImageOps\n\nasync def enhance_image(\n    img: Image.Image,\n    brightness: float = 1.0,\n    contrast: float = 1.0,\n    saturation: float = 1.0\n) -> Image.Image:\n    \"\"\"Apply color enhancements to image.\"\"\" enhancers = [\n        (ImageEnhance.Brightness, brightness),\n        (ImageEnhance.Contrast, contrast),\n        (ImageEnhance.Color, saturation)\n    ]\n\n    for Enhancer, factor in enhancers:\n        if factor != 1.0:\n            img = Enhancer(img).enhance(factor)\n\n    return img\n```\n\n### Filters and Effects\n\nApply visual effects and filters to images:\n\n```python\nfrom PIL import ImageFilter\n\ndef apply_effects(img: Image.Image) -> Image.Image:\n    \"\"\"Apply various filters and effects.\"\"\" effects = {\n        'blur': ImageFilter.GaussianBlur(radius=2),\n        'sharpen': ImageFilter.SHARPEN,\n        'edge': ImageFilter.FIND_EDGES,\n        'emboss': ImageFilter.EMBOSS\n    }\n\n    return {name: img.filter(effect)\n            for name, effect in effects.items()}\n```\n\n### Drawing and Text\n\nAdd text, shapes, and overlays to images:\n\n```python\nfrom PIL import Image, ImageDraw, ImageFont\n\nasync def add_watermark(\n    img: Image.Image,\n    text: str,\n    font_size: int = 30\n) -> Image.Image:\n    \"\"\"Add text watermark to image.\"\"\" draw = ImageDraw.Draw(img)\n    font = ImageFont.truetype(\"arial.ttf\", font_size)\n\n    # Calculate text size and position\n    text_bbox = draw.textbbox((0, 0), text, font=font)\n    text_width = text_bbox[2] - text_bbox[0]\n    text_height = text_bbox[3] - text_bbox[1]\n\n    # Position text at bottom-right\n    x = img.width - text_width - 10\n    y = img.height - text_height - 10\n\n    # Add text with shadow\n    draw.text((x+2, y+2), text, font=font, fill='black')\n    draw.text((x, y), text, font=font, fill='white')\n\n    return img\n```\n\n### Memory-Efficient Processing\n\nHandle large images without loading them entirely into memory:\n\n```python\nfrom PIL import Image\nimport os\n\nasync def process_large_images(\n    input_dir: str,\n    output_dir: str,\n    max_size: tuple[int, int]\n) -> None:\n    \"\"\"Process multiple large images efficiently.\"\"\" os.makedirs(output_dir, exist_ok=True)\n\n    for filename in os.listdir(input_dir):\n        if not filename.lower().endswith(('.png', '.jpg', '.jpeg')):\n            continue\n\n        input_path = os.path.join(input_dir, filename)\n        output_path = os.path.join(output_dir, filename)\n\n        with Image.open(input_path) as img:\n            # Process in chunks using thumbnail\n            img.thumbnail(max_size)\n            img.save(output_path, optimize=True)\n```\n\nPractice with these resources:\n\n- [Pillow Documentation](https://pillow.readthedocs.io/): Complete API reference\n- [Python Image Processing Tutorial](https://realpython.com/image-processing-with-the-python-pillow-library/): In-depth guide\n- [Sample Images Dataset](https://www.kaggle.com/datasets/lamsimon/celebs): Test images for practice\n\nWatch these tutorials for hands-on demonstrations:\n\n[! [Image Processing Tutorial for beginners with Python PIL in 30 mins](https://i.ytimg.com/vi_webp/dkp4wUhCwR4/sddefault.webp)](https://youtu.be/dkp4wUhCwR4)\n\n### Image Processing with ImageMagick\n\n[ImageMagick](https://imagemagick.org/) is a powerful command-line tool for image manipulation, offering features beyond what's possible with Python libraries. It's particularly useful for:\n\n- Batch processing large image collections\n- Complex image transformations\n- High-quality format conversion\n- Creating image thumbnails\n- Adding text and watermarks\n\nBasic Operations:\n\n```bash\n# Format conversion\nconvert input.png output.jpg\n\n# Resize image (maintains aspect ratio)\nconvert input.jpg -resize 800x600 output.jpg\n\n# Compress image quality\nconvert input.jpg -quality 85 output.jpg\n\n# Rotate image\nconvert input.jpg -rotate 90 output.jpg\n```\n\nCommon Data Science Tasks:\n\n```bash\n# Create thumbnails for dataset preview\nconvert input.jpg -thumbnail 200x200^ -gravity center -extent 200x200 thumb.jpg\n\n# Normalize image for ML training\nconvert input.jpg -normalize -strip output.jpg\n\n# Extract dominant colors\nconvert input.jpg -colors 5 -unique-colors txt:\n\n# Generate image statistics\nidentify -verbose input.jpg | grep -E \"Mean|Standard|Kurtosis\"\n```\n\nBatch Processing:\n\n```bash\n# Convert all images in a directory\nmogrify -format jpg *.png\n\n# Resize multiple images\nmogrify -resize 800x600 -path output/ *.jpg\n\n# Add watermark to images\nfor f in *.jpg; do\n    convert \"$f\" -gravity southeast -draw \"text 10,10 'Copyright'\" \"watermarked/$f\"\ndone\n```\n\nAdvanced Features:\n\n```bash\n# Apply image effects\nconvert input.jpg -blur 0x3 blurred.jpg\nconvert input.jpg -sharpen 0x3 sharp.jpg\nconvert input.jpg -edge 1 edges.jpg\n\n# Create image montage\nmontage *.jpg -geometry 200x200+2+2 montage.jpg\n\n# Extract image channels\nconvert input.jpg -separate channels_%d.jpg\n\n# Composite images\ncomposite overlay.png -gravity center base.jpg output.jpg\n```\n\nWatch this ImageMagick tutorial (16 min):\n\n[! [ImageMagick Introduction (16 min)](https://i.ytimg.com/vi_webp/wjcBOoReYc0/sddefault.webp)](https://youtu.be/wjcBOoReYc0)\n\nTools:\n\n- [Fred's ImageMagick Scripts](http://www.fmwconcepts.com/imagemagick/): Useful script collection\n- [ImageMagick Online Studio](https://magickstudio.imagemagick.org/): Visual command builder\n\nTips:\n\n1. Use `-strip` to remove metadata and reduce file size\n2. Monitor memory usage with `-limit memory 1GB`\n3. Use `-define` for format-specific options\n4. Process in parallel with `-parallel`\n5. Use `-monitor` to track progress\n\nError Handling:\n\n```bash\n# Check image validity\nidentify -regard-warnings input.jpg\n\n# Get detailed error information\nconvert input.jpg output.jpg 2>&1 | grep -i \"error\"\n\n# Set resource limits\nconvert -limit memory 1GB -limit map 2GB input.jpg output.jpg\n```\n\nFor Python integration:\n\n```python\n# /// script\n# requires-python = \">=3.9\"\n# dependencies = [\"Wand\"]\n# ///\n\nfrom wand.image import Image\n\nasync def process_image(path: str) -> None:\n    \"\"\"Process image with ImageMagick via Wand.\"\"\" with Image(filename=path) as img:\n        # Basic operations\n        img.resize(800, 600)\n        img.normalize()\n\n        # Apply effects\n        img.sharpen(radius=0, sigma=3)\n\n        # Save with compression\n        img.save(filename='output.jpg')\n```\n\nNote: Always install ImageMagick before using the Wand Python binding."
}