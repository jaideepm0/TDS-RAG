{
  "id": "scheduled-scraping-with-github-actions.md#0",
  "post_urls": [
    "https://tds.s-anand.net/#/scheduled-scraping-with-github-actions.md",
    "https://tds.s-anand.net/#/../scheduled-scraping-with-github-actions.md"
  ],
  "content": "## Scheduled Scraping with GitHub Actions\n\nGitHub Actions provides an excellent platform for running web scrapers on a schedule. This tutorial shows how to automate data collection from websites using GitHub Actions workflows. ### Key Concepts\n\n- **Scheduling**: Use [cron syntax](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#schedule) to run scrapers at specific times\n- **Dependencies**: Install required packages like `httpx`, `lxml`\n- **Data Storage**: Save scraped data to files and commit back to the repository\n- **Error Handling**: Implement robust error handling for network issues and HTML parsing\n- **Rate Limiting**: Respect website terms of service and implement delays between requests\n\nHere's a sample `scrape.py` that scrapes the IMDb Top 250 movies using httpx and lxml:\n\n```python\nimport json\nimport httpx\nfrom datetime import datetime, UTC\nfrom lxml import html\nfrom typing import List, Dict\n\n\ndef scrape_imdb() -> List[Dict[str, str]]:\n    \"\"\"Scrape IMDb Top 250 movies using httpx and lxml. Returns:\n        List of dictionaries containing movie title, year, and rating.\n    \"\"\" headers = {\"User-Agent\": \"Mozilla/5.0 (compatible; IMDbBot/1.0)\"}\n    response = httpx.get(\"https://www.imdb.com/chart/top/\", headers=headers)\n    response.raise_for_status()\n\n    tree = html.fromstring(response.text)\n    movies = []\n\n    for item in tree.cssselect(\".ipc-metadata-list-summary-item\"):\n        title = (\n            item.cssselect(\".ipc-title__text\")[0].text_content()\n            if item.cssselect(\".ipc-title__text\")\n            else None\n        )\n        year = (\n            item.cssselect(\".cli-title-metadata span\")[0].text_content()\n            if item.cssselect(\".cli-title-metadata span\")\n            else None\n        )\n        rating = (\n            item.cssselect(\".ipc-rating-star\")[0].text_content()\n            if item.cssselect(\".ipc-rating-star\")\n            else None\n        )\n\n        if title and year and rating:\n            movies.append({\"title\": title, \"year\": year, \"rating\": rating})\n\n    return movies\n\n\n# Scrape data and save with timestamp\nnow = datetime.now(UTC)\nwith open(f'imdb-top250-{now.strftime(\"%Y-%m-%d\")}.json', \"a\") as f:\n    f.write(json.dumps({\"timestamp\": now.isoformat(), \"movies\": scrape_imdb()}) + \"\\n\")\n```\n\nHere's a sample `.github/workflows/imdb-top250.yml` that runs the scraper daily and saves the data:\n\n```yaml\nname: Scrape IMDb Top 250\n\non:\n  schedule:\n    # Runs at 00:00 UTC every day\n    - cron: \"0 0 * * *\"\n  workflow_dispatch: # Allow manual triggers\n\njobs:\n  scrape-imdb:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: write\n\n    steps:\n      - name: Checkout repository\n        uses: actions/checkout@v4\n\n      - name: Install uv\n        uses: astral-sh/setup-uv@v5\n\n      - name: Run scraper\n        run: | # python\n          uv run --with httpx,lxml,cssselect python scrape.py\n\n      - name: Commit and push changes\n        run: |\n          git config --local user.email \"github-actions[bot]@users.noreply.github.com\"\n          git config --local user.name \"github-actions[bot]\"\n          git add *.json\n          git commit -m \"Update IMDb Top 250 data [skip ci]\" || exit 0\n          git push\n```\n\n### Best Practices\n\n1. **Cache Dependencies**: Use GitHub's caching to speed up package installation\n2. **Handle Errors**: Implement retries and error logging\n3. **Rate Limiting**: Add delays between requests to avoid overwhelming servers\n4. **Data Validation**: Verify scraped data structure before saving\n5. **Monitoring**: Set up notifications for workflow failures\n\n### Tools and Resources\n\n- [httpx](https://www.python-httpx.org/): Async HTTP client\n- [GitHub Actions Marketplace](https://github.com/marketplace?type=actions)\n- [GitHub Actions Documentation](https://docs.github.com/en/actions)\n\n### Video Tutorials\n\n[! [How to run Github Actions on a Schedule](https://i.ytimg.com/vi_webp/eJG86J200nM/sddefault.webp)](https://youtu.be/eJG86J200nM)"
}